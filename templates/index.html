{% extends "base.html" %}
{% load static %}
{% load socialaccount %}

{% block content %}
    <!-- Add SweetAlert2 CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <header class="header">
        <nav class="nav">
            <div class="logo">
                <span class="logo-img">
                    <img src="{% static 'images/GraspEd-logo-text.png' %}" alt="GraspEd Logo" height="32"/>
                </span>
            </div>
            <div class="nav-links">
                <a href="#features">Features</a>
                <a href="#about">About</a>
                <a href="#contact">Contact</a>
                <a href="#" class="btn btn-login">Login</a>
                <a href="#" class="btn btn-signup">Sign Up</a>
            </div>
            <!-- Hamburger Button -->
            <button id="hamburger-btn" class="hamburger" aria-label="Open navigation" aria-expanded="false" aria-controls="mobile-nav">
              <div class="hamburger-inner">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </button>
            <!-- Mobile Nav Sidebar -->
            <div id="mobile-nav" class="mobile-nav">
              <div class="mobile-nav-links">
                <a href="#features">Features</a>
                <a href="#about">About</a>
                <a href="#contact">Contact</a>
                <a href="#" class="btn btn-login">Login</a>
                <a href="#" class="btn btn-signup">Sign Up</a>
              </div>
            </div>
        </nav>
    </header>

    <main>
        <section class="hero">
            <div class="hero-content">
                <h1>Welcome to GraspEd</h1>
                <p class="hero-subtitle">The platform where students and teachers connect, collaborate, and learn together</p>
                <div class="hero-buttons">
                    <a href="#" class="btn btn-primary btn-get-started">Get Started</a>
                    <a href="#features" class="btn btn-secondary">Learn More</a>
                </div>
            </div>
            <div class="hero-image">
                <img src="{% static './images/teacher&student.png' %}" alt="Students and teachers collaborating online">
            </div>
        </section>

        <section id="features" class="features">
            <h2>Key Features</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <h3>Easy Communication</h3>
                    <p>Connect with teachers and students through our intuitive messaging system</p>
                </div>
                <div class="feature-card">
                    <h3>Resource Sharing</h3>
                    <p>Share and access educational materials, assignments, and study resources</p>
                </div>
                <div class="feature-card">
                    <h3>Interactive Learning</h3>
                    <p>Engage in discussions, group projects, and collaborative learning</p>
                </div>
            </div>
        </section>

        <section id="about" class="about">
            <h2>About GraspEd</h2>
            <p>GraspEd is designed to bridge the gap between students and teachers, creating a seamless learning environment where everyone can thrive. Our platform makes it easy to communicate, share resources, and collaborate on educational goals.</p>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <span class="footer-logo">
                    <img src="{% static './images/GraspEd-logo-text.png' %}" alt="GraspEd Logo" height="32"/>
                </span>
                <p>Empowering education through connection</p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <a href="#features">Features</a>
                <a href="#about">About</a>
                <a href="#contact">Contact</a>
            </div>
            <div class="footer-section">
                <h4>Contact Us</h4>
                <p>Email: nafilmnytfj@gmail.com</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 GraspEd. All rights reserved.</p>
        </div>
    </footer>

    <!-- Login Sidebar -->
    <div id="login-sidebar" class="sidebar">
        <div class="sidebar-content">
            <span class="close-btn-circle" id="close-login-sidebar"><span class="close-btn">&times;</span></span>
            <h2>Login to Your Account</h2>
            <form id="login-form" style="margin-top:2rem;">
                <div class="input-group">
                    <input type="text" id="login-username" name="username" required>
                    <label for="login-username">Username</label>
                </div>
                <div class="input-group">
                    <input type="password" id="login-password" name="password" required>
                    <label for="login-password">Password</label>
                    <span class="toggle-password" id="toggle-login-password" tabindex="0" aria-label="Show password">
                        <svg id="eye-icon" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#e63038" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </span>
                </div>
                <button type="submit" class="btn btn-primary" style="width:100%; margin-top:1rem;">Login</button>
                <a href="{% provider_login_url 'google' %}" class="btn btn-secondary" style="width:100%; margin-top:1rem; background:#fff; color:#e63038; border:1px solid #e63038; display:inline-block; text-align:center;">
                    <img src="https://developers.google.com/identity/images/g-logo.png" style="height:20px;vertical-align:middle;margin-right:8px;">
                    Continue with Google
                </a>
            </form>
        </div>
    </div>

    <!-- Sign Up Sidebar -->
    <div id="signup-sidebar" class="sidebar">
        <div class="sidebar-content">
            <span class="close-btn-circle" id="close-sidebar"><span class="close-btn">&times;</span></span>
            <h2 id="sidebar-title">Create an Account</h2>
            <div class="account-type-tabs" id="account-type-tabs">
                <button class="tab-btn teacher-btn">Create Teacher Account</button>
                <button class="tab-btn student-btn">Create Student Account</button>
            </div>
            <form id="signup-form" style="display:none; margin-top:2rem;">
                <button type="button" id="back-to-tabs" style="margin-bottom:1.2rem;display:none;" class="btn btn-secondary back-icon-btn" aria-label="Back">&#8592;</button>
                <div class="input-group">
                    <input type="text" id="signup-username" name="username" required>
                    <label for="signup-username">Username</label>
                </div>
                <div class="input-group">
                    <input type="password" id="signup-password" name="password" required>
                    <label for="signup-password">Password</label>
                    <span class="toggle-password" id="toggle-password" tabindex="0" aria-label="Show password">
                        <svg id="eye-icon" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#e63038" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </span>
                </div>
                <div class="input-group">
                    <input type="text" id="signup-school" name="school_name" required>
                    <label for="signup-school">School Name</label>
                </div>
                <button type="submit" class="btn btn-primary" style="width:100%; margin-top:1rem;">Create Account</button>
            </form>
        </div>
    </div>

    <style>
    /* Hamburger/close button always top right, above sidebar */
    .hamburger {
      display: none;
      justify-content: center;
      align-items: center;
      width: 52px;
      height: 52px;
      background: #fff;
      border: none;
      border-radius: 50%;
      box-shadow: 0 2px 12px rgba(230,57,70,0.10);
      cursor: pointer;
      z-index: 12001;
      position: fixed;
      top: 1.5rem;
      right: 1.5rem;
      transition: box-shadow 0.2s, background 0.2s;
      padding: 0;
    }
    .hamburger:hover, .hamburger.active {
      box-shadow: 0 4px 24px #e6303840;
      background: #ffe5e5;
    }
    .hamburger-inner {
      position: relative;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .hamburger span {
      position: absolute;
      left: 0;
      width: 28px;
      height: 4px;
      background: #e63038;
      border-radius: 2px;
      transition: 0.3s;
    }
    .hamburger span:nth-child(1) {
      top: 0;
    }
    .hamburger span:nth-child(2) {
      top: 12px;
    }
    .hamburger span:nth-child(3) {
      top: 24px;
    }
    .hamburger.active span:nth-child(1) {
      top: 12px;
      transform: rotate(45deg);
    }
    .hamburger.active span:nth-child(2) {
      opacity: 0;
    }
    .hamburger.active span:nth-child(3) {
      top: 12px;
      transform: rotate(-45deg);
    }

    /* Sidebar animation and style */
    .mobile-nav {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: fixed;
      top: 0;
      right: 0;
      width: 340px;
      max-width: 90vw;
      height: 90vh;
      min-height: 340px;
      background: linear-gradient(135deg, #fff0f0 0%, #ffe5e5 100%);
      z-index: 11000;
      box-shadow: -8px 0 32px 0 rgba(230,57,70,0.18), 0 8px 32px 0 rgba(230,57,70,0.10);
      border-top-left-radius: 2.2rem;
      border-bottom-left-radius: 2.2rem;
      transform: translateX(120%) scale(0.98);
      opacity: 0;
      pointer-events: none;
      transition: transform 0.5s cubic-bezier(.77,0,.18,1), opacity 0.3s;
    }
    .mobile-nav.open {
      transform: translateX(0) scale(1);
      opacity: 1;
      pointer-events: auto;
    }
    .mobile-nav-links {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2.2rem;
      width: 100%;
      margin-top: 2rem;
    }
    .mobile-nav-links a {
      font-size: 1.7rem;
      color: #e63038;
      text-decoration: none;
      font-weight: 800;
      text-align: center;
      width: auto;
      min-width: 120px;
      max-width: 90%;
      opacity: 0;
      transform: translateY(40px) scale(0.95);
      transition: opacity 0.5s, transform 0.5s;
      border-radius: 1.2rem;
      padding: 0.7rem 1.5rem;
      background: none;
      margin-left: auto;
      margin-right: auto;
      box-sizing: border-box;
    }
    .mobile-nav.open .mobile-nav-links a {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    .mobile-nav.open .mobile-nav-links a:nth-child(1) { transition-delay: 0.18s; }
    .mobile-nav.open .mobile-nav-links a:nth-child(2) { transition-delay: 0.28s; }
    .mobile-nav.open .mobile-nav-links a:nth-child(3) { transition-delay: 0.38s; }
    .mobile-nav.open .mobile-nav-links a:nth-child(4) { transition-delay: 0.48s; }
    .mobile-nav.open .mobile-nav-links a:nth-child(5) { transition-delay: 0.58s; }
    .mobile-nav-links a.btn {
      background: linear-gradient(90deg, #e63038 0%, #ff7e5f 100%);
      color: #fff;
      font-weight: 900;
      margin-top: 0.5rem;
      box-shadow: 0 4px 24px #e6303840;
      border: none;
      font-size: 1.3rem;
      padding: 1rem 2.5rem;
      border-radius: 2rem;
      transition: background 0.3s, color 0.3s, transform 0.2s;
    }
    .mobile-nav-links a.btn:hover {
      background: linear-gradient(90deg, #ff7e5f 0%, #e63038 100%);
      color: #fff;
      transform: scale(1.07);
    }

    
    /* Responsive: hide nav-links, show hamburger on small screens */
    @media (max-width: 900px) {
      .nav-links {
        display: none !important;
      }
      .hamburger {
        display: flex;
      }
      .mobile-nav {
        height: 100vh;
        min-height: 0;
        border-radius: 0;
        border-top-left-radius: 2.2rem;
        border-bottom-left-radius: 2.2rem;
      }
    }
    </style>

    <script>
    let selectedUserType = null;

    // Login sidebar logic
    document.querySelector('.btn-login').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('login-sidebar').classList.add('open');
    });

    document.getElementById('close-login-sidebar').addEventListener('click', function() {
        document.getElementById('login-sidebar').classList.remove('open');
    });

    window.addEventListener('click', function(e) {
        const loginSidebar = document.getElementById('login-sidebar');
        if (e.target === loginSidebar) {
            loginSidebar.classList.remove('open');
        }
    });

    // Signup sidebar logic
    document.querySelectorAll('.btn-signup, .btn-get-started').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('signup-sidebar').classList.add('open');
        });
    });

    document.getElementById('close-sidebar').addEventListener('click', function() {
        document.getElementById('signup-sidebar').classList.remove('open');
    });

    window.addEventListener('click', function(e) {
        const signupSidebar = document.getElementById('signup-sidebar');
        if (e.target === signupSidebar) {
            signupSidebar.classList.remove('open');
        }
    });

    // Mobile sidebar button event listeners
    document.addEventListener('DOMContentLoaded', function() {
        // Add event listeners for mobile sidebar login button
        const mobileLoginBtn = document.querySelector('.mobile-nav-links .btn-login');
        if (mobileLoginBtn) {
            mobileLoginBtn.addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('login-sidebar').classList.add('open');
                // Close mobile sidebar when opening login
                document.getElementById('mobile-nav').classList.remove('open');
                document.getElementById('hamburger-btn').classList.remove('active');
                document.getElementById('hamburger-btn').setAttribute('aria-expanded', 'false');
            });
        }

        // Add event listeners for mobile sidebar signup button
        const mobileSignupBtn = document.querySelector('.mobile-nav-links .btn-signup');
        if (mobileSignupBtn) {
            mobileSignupBtn.addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('signup-sidebar').classList.add('open');
                // Close mobile sidebar when opening signup
                document.getElementById('mobile-nav').classList.remove('open');
                document.getElementById('hamburger-btn').classList.remove('active');
                document.getElementById('hamburger-btn').setAttribute('aria-expanded', 'false');
            });
        }
    });

    // Account type selection
    document.querySelector('.teacher-btn').addEventListener('click', function() {
        selectedUserType = 'teacher';
        document.getElementById('account-type-tabs').style.display = 'none';
        document.getElementById('signup-form').style.display = 'block';
        document.getElementById('back-to-tabs').style.display = 'block';
        document.getElementById('sidebar-title').textContent = 'Create Teacher Account';
    });

    document.querySelector('.student-btn').addEventListener('click', function() {
        selectedUserType = 'student';
        document.getElementById('account-type-tabs').style.display = 'none';
        document.getElementById('signup-form').style.display = 'block';
        document.getElementById('back-to-tabs').style.display = 'block';
        document.getElementById('sidebar-title').textContent = 'Create Student Account';
    });

    document.getElementById('back-to-tabs').addEventListener('click', function() {
        document.getElementById('account-type-tabs').style.display = 'flex';
        document.getElementById('signup-form').style.display = 'none';
        document.getElementById('back-to-tabs').style.display = 'none';
        selectedUserType = null;
    });

    // Password toggle functionality
    document.getElementById('toggle-login-password').addEventListener('click', function() {
        const passwordInput = document.getElementById('login-password');
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
        } else {
            passwordInput.type = 'password';
        }
    });

    document.getElementById('toggle-password').addEventListener('click', function() {
        const passwordInput = document.getElementById('signup-password');
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
        } else {
            passwordInput.type = 'password';
        }
    });

    // Form submissions
    document.getElementById('login-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        const username = document.getElementById('login-username').value;
        const password = document.getElementById('login-password').value;

        // Show loading state
        Swal.fire({
            title: 'Logging in...',
            text: 'Please wait while we authenticate you.',
            allowOutsideClick: false,
            allowEscapeKey: false,
            showConfirmButton: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });

        try {
            const response = await fetch('/login/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': getCookie('csrftoken'),
                },
                body: JSON.stringify({ username, password })
            });

            const data = await response.json();
            if (data.status === 'success') {
                Swal.fire({
                    title: 'Welcome Back!',
                    text: 'Login successful! Redirecting to your dashboard...',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                }).then(() => {
                    window.location.href = data.redirect_url;
                });
            } else {
                Swal.fire({
                    title: 'Login Failed',
                    text: data.message || 'Invalid username or password.',
                    icon: 'error',
                    confirmButtonText: 'Try Again'
                });
            }
        } catch (error) {
            Swal.fire({
                title: 'Connection Error',
                text: 'Unable to connect to the server. Please check your internet connection and try again.',
                icon: 'error',
                confirmButtonText: 'OK'
            });
        }
    });

    document.getElementById('signup-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        const username = document.getElementById('signup-username').value;
        const password = document.getElementById('signup-password').value;
        const school = document.getElementById('signup-school').value;

        if (!selectedUserType) {
            Swal.fire({
                title: 'Account Type Required',
                text: 'Please select an account type (Teacher or Student).',
                icon: 'warning',
                confirmButtonText: 'OK'
            });
            return;
        }

        // Show loading state
        Swal.fire({
            title: 'Creating Account...',
            text: 'Please wait while we set up your account.',
            allowOutsideClick: false,
            allowEscapeKey: false,
            showConfirmButton: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });

        try {
            const response = await fetch('/signup/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': getCookie('csrftoken'),
                },
                body: JSON.stringify({ 
                    username, 
                    password, 
                    school_name: school,
                    user_type: selectedUserType 
                })
            });

            const data = await response.json();
            if (data.status === 'success') {
                Swal.fire({
                    title: 'Account Created!',
                    text: 'Your account has been created successfully. Please log in to continue.',
                    icon: 'success',
                    confirmButtonText: 'Login Now'
                }).then(() => {
                    document.getElementById('signup-sidebar').classList.remove('open');
                    document.getElementById('login-sidebar').classList.add('open');
                    // Clear the signup form
                    document.getElementById('signup-form').reset();
                    document.getElementById('account-type-tabs').style.display = 'flex';
                    document.getElementById('signup-form').style.display = 'none';
                    document.getElementById('back-to-tabs').style.display = 'none';
                    selectedUserType = null;
                });
            } else {
                Swal.fire({
                    title: 'Signup Failed',
                    text: data.message || 'Unable to create account. Please try again.',
                    icon: 'error',
                    confirmButtonText: 'Try Again'
                });
            }
        } catch (error) {
            Swal.fire({
                title: 'Connection Error',
                text: 'Unable to connect to the server. Please check your internet connection and try again.',
                icon: 'error',
                confirmButtonText: 'OK'
            });
        }
    });

    // Helper function to get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
   
   // Floating label functionality
   function handleFloatingLabels() {
       const inputs = document.querySelectorAll('.input-group input');
       
       inputs.forEach(input => {
           // Check if input has value on page load
           if (input.value.trim() !== '') {
               input.classList.add('filled');
           }
           
           // Handle focus event
           input.addEventListener('focus', function() {
               this.classList.add('focused');
           });
           
           // Handle blur event
           input.addEventListener('blur', function() {
               this.classList.remove('focused');
               if (this.value.trim() !== '') {
                   this.classList.add('filled');
               } else {
                   this.classList.remove('filled');
               }
           });
           
           // Handle input event (for real-time updates)
           input.addEventListener('input', function() {
               if (this.value.trim() !== '') {
                   this.classList.add('filled');
               } else {
                   this.classList.remove('filled');
               }
           });
       });
   }
   
   // Initialize floating labels when DOM is loaded
   document.addEventListener('DOMContentLoaded', function() {
       handleFloatingLabels();
   });
    </script>
    <script>
    const hamburgerBtn = document.getElementById('hamburger-btn');
    const mobileNav = document.getElementById('mobile-nav');

    if (hamburgerBtn && mobileNav) {
      hamburgerBtn.addEventListener('click', function() {
        const isOpen = mobileNav.classList.toggle('open');
        hamburgerBtn.classList.toggle('active');
        this.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
      });
      // Close sidebar when clicking a link
      mobileNav.addEventListener('click', function(e) {
        if (e.target.tagName === 'A') {
          mobileNav.classList.remove('open');
          hamburgerBtn.classList.remove('active');
          hamburgerBtn.setAttribute('aria-expanded', 'false');
        }
      });
    }
    </script>
{% endblock %}