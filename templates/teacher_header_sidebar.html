{% load static %}
<!-- NOTE: Move the following <style> block to the <head> of your base template for valid HTML. -->
<style>
  #left-sidebar nav a {
    color: inherit !important;
    transition: color 0.2s, background 0.2s;
  }
  #left-sidebar nav a .sidebar-link-text {
    color: inherit !important;
    transition: color 0.2s;
  }
  #left-sidebar nav a:hover,
  #left-sidebar nav a:focus {
    color: #e63038 !important;
    background: #fff0f0;
  }
  #left-sidebar nav a:hover .sidebar-link-text,
  #left-sidebar nav a:focus .sidebar-link-text {
    color: #e63038 !important;
  }
  #left-sidebar nav a:hover svg *,
  #left-sidebar nav a:focus svg * {
    stroke: #e63038 !important;
  }
  #left-sidebar nav a svg * {
    transition: stroke 0.2s;
  }
</style>
<style>
  /* Header tabs */
  .top-tabs {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    background: #fff;
    padding: 0.25rem;
    border-radius: 1.5rem;
    box-shadow: 0 2px 12px rgba(230,57,70,0.10);
    position: relative;
    isolation: isolate;
  }
  .top-tabs .tab-link { 
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.55rem 1.1rem;
    border-radius: 1.2rem;
    text-decoration: none;
    font-weight: 800;
    letter-spacing: 0.2px;
    color: #e63038;
    transition: color 0.2s, transform 0.2s, box-shadow 0.2s, background 0.2s;
    will-change: transform; 
    z-index: 1;
  }
  .top-tabs .tab-link:hover { transform: translateY(-1px); }
  .top-tabs .tab-link.active {
    color: #fff !important;
    background: linear-gradient(90deg, #e63038 0%, #ff7e5f 100%);
    box-shadow: 0 4px 18px rgba(230,57,70,0.35);
  }
  .top-tabs .tab-link .pulse {
    position: absolute; inset: 0; border-radius: 1.2rem;
    box-shadow: 0 0 0 0 rgba(230,57,70,0.25);
    animation: tabPulse 2.2s infinite; pointer-events:none; opacity:0;
  }
  .top-tabs .tab-link.active .pulse { opacity: 1; }
  @keyframes tabPulse {
    0% { box-shadow: 0 0 0 0 rgba(230,57,70,0.25); }
    70% { box-shadow: 0 0 0 14px rgba(230,57,70,0); }
    100% { box-shadow: 0 0 0 0 rgba(230,57,70,0); }
  }
  .top-tabs .active-indicator {
    position: absolute; top: 4px; left: 4px; height: calc(100% - 8px); width: 50%;
    background: linear-gradient(90deg, #e63038 0%, #ff7e5f 100%);
    border-radius: 1.2rem; box-shadow: 0 4px 18px rgba(230,57,70,0.35);
    transition: transform 240ms cubic-bezier(.22,.61,.36,1), width 240ms ease; z-index: 0;
  }
  .top-tabs .tab-icon { width: 22px; height: 22px; margin-right: 0.55rem; transition: opacity 180ms ease, transform 180ms ease; }
  .top-tabs .tab-icon.inactive { opacity: 0.7; filter: saturate(0.4) brightness(1.15); }
  .top-tabs .tab-link.active .tab-icon.inactive { opacity: 0; transform: scale(0.9); }
  .top-tabs .tab-link:not(.active) .tab-icon.active { opacity: 0; transform: scale(0.9); }
  .top-tabs .tab-link.active .tab-icon.active { opacity: 1; transform: scale(1); }
</style>
<!-- Header -->
<header style="width:100%; background:#fff; box-shadow:0 2px 12px rgba(230,57,70,0.07); display:flex; align-items:center; justify-content:space-between; padding:1.2rem 2.5rem 1.2rem 2.5rem; position:sticky; top:0; z-index:100;">
  <div style="display:flex; align-items:center; gap:1.2rem;">
    <!-- Hamburger Icon -->
    <button id="hamburger-btn" style="background:none; border:none; cursor:pointer; padding:0; margin:0; display:flex; align-items:center;">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect y="5" width="24" height="2.5" rx="1.2" fill="#e63038"/>
        <rect y="11" width="24" height="2.5" rx="1.2" fill="#e63038"/>
        <rect y="17" width="24" height="2.5" rx="1.2" fill="#e63038"/>
      </svg>
    </button>
    <img src="/static/images/GraspEd-logo-text.png" alt="GraspEd Logo" class="animated-logo" style="height:2.5rem; width:auto; display:block;"/>
    </div>
  <div class="top-tabs" id="header-tabs-teacher">
    <a href="/teacher/dashboard/" class="tab-link {% if active_page != 'community' %}active{% endif %}">
      <img class="tab-icon active" src="{% static 'images/blackboard-active.png' %}" alt="Classroom Active"/>
      <img class="tab-icon inactive" src="{% static 'images/blackboard-inactive.png' %}" alt="Classroom Inactive"/>
      <span>Classroom</span>
      <span class="pulse"></span>
    </a>
    <a href="{% url 'web:community' %}" class="tab-link {% if active_page == 'community' %}active{% endif %}">
      <img class="tab-icon active" src="{% static 'images/group-active.png' %}" alt="Community Active"/>
      <img class="tab-icon inactive" src="{% static 'images/group-inactive.png' %}" alt="Community Inactive"/>
      <span>Community</span>
      <span class="pulse"></span>
    </a>
    <span class="active-indicator"></span>
  </div>
  <div style="display:flex; align-items:center; gap:1rem;">
    <button id="profile-btn" style="background:none; border:none; cursor:pointer; outline:none; padding:0; margin:0;">
      <span style="display:inline-block; width:2.8rem; height:2.8rem; border-radius:50%; background:linear-gradient(135deg,#e63038,#ff7e5f); display:flex; align-items:center; justify-content:center; box-shadow:0 2px 8px #e6303820;">
        {% if user.teacheraccount.profile_photo %}
          <img src="{{ user.teacheraccount.profile_photo.url }}" alt="Profile Photo" style="width:100%; height:100%; object-fit:cover; border-radius:50%; border: 1px solid #ffb3b3; box-sizing: border-box;"/>
        {% else %}
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="8" r="4" stroke="#fff" stroke-width="2"/>
            <path d="M4 20c0-2.21 3.58-4 8-4s8 1.79 8 4" stroke="#fff" stroke-width="2"/>
          </svg>
        {% endif %}
      </span>
    </button>
  </div>
</header>
<!-- Sidebar overlay for hamburger menu -->
<div id="left-sidebar-overlay" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.18); z-index:2100;"></div>
<!-- Left Sidebar -->
<aside id="left-sidebar" style="position:fixed; top:0; left:-270px; width:250px; height:100vh; background:#fff; box-shadow:4px 0 32px #e6303820; z-index:2200; transition:left 0.35s cubic-bezier(.77,0,.18,1); display:flex; flex-direction:column; padding:2.5rem 1.2rem 1.2rem 1.2rem;">
  <div style="font-size:1.3rem; font-weight:800; color:#e63038; margin-bottom:2.5rem; display:flex; align-items:center; gap:0.7rem;">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" style="vertical-align:middle;" xmlns="http://www.w3.org/2000/svg">
      <rect x="2" y="2" width="20" height="20" rx="6" fill="#fff0f0" stroke="#e63038" stroke-width="2"/>
      <path d="M8 12h8M8 16h8M8 8h8" stroke="#e63038" stroke-width="2" stroke-linecap="round"/>
    </svg>
    Menu
    </div>
  <nav style="display:flex; flex-direction:column; gap:1.2rem;">
    <a href="/teacher/dashboard/" style="display:flex; align-items:center; gap:1rem; color:{% if active_page == 'dashboard' %}#e63038{% else %}#666{% endif %} !important; font-weight:{% if active_page == 'dashboard' %}700{% else %}600{% endif %}; font-size:1.1rem; text-decoration:none; padding:0.7rem 1rem; border-radius:0.8rem; transition:background 0.2s;">
      <span style="display:inline-flex; align-items:center;">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="7" width="18" height="13" rx="3" stroke="{% if active_page == 'dashboard' %}#e63038{% else %}#666{% endif %}" stroke-width="2"/>
          <rect x="7" y="3" width="10" height="4" rx="2" stroke="{% if active_page == 'dashboard' %}#e63038{% else %}#666{% endif %}" stroke-width="2"/>
        </svg>
      </span>
      <span class="sidebar-link-text">Dashboard</span>
    </a>
    <a href="/teacher/notes/" style="display:flex; align-items:center; gap:1rem; color:{% if active_page == 'notes' %}#e63038{% else %}#666{% endif %} !important; font-weight:{% if active_page == 'notes' %}700{% else %}600{% endif %}; font-size:1.1rem; text-decoration:none; padding:0.7rem 1rem; border-radius:0.8rem; transition:all 0.2s;">
      <span style="display:inline-flex; align-items:center;">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M14 2H6C4.89543 2 4 2.89543 4 4V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V8L14 2Z" stroke="{% if active_page == 'notes' %}#e63038{% else %}#666{% endif %}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M14 2V8H20" stroke="{% if active_page == 'notes' %}#e63038{% else %}#666{% endif %}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M16 13H8" stroke="{% if active_page == 'notes' %}#e63038{% else %}#666{% endif %}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M16 17H8" stroke="{% if active_page == 'notes' %}#e63038{% else %}#666{% endif %}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M10 9H8" stroke="{% if active_page == 'notes' %}#e63038{% else %}#666{% endif %}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </span>
      <span class="sidebar-link-text">Notes</span>
    </a>
    <a href="/teacher/attendance/" style="display:flex; align-items:center; gap:1rem; color:{% if active_page == 'attendance' %}#e63038{% else %}#666{% endif %} !important; font-weight:{% if active_page == 'attendance' %}700{% else %}600{% endif %}; font-size:1.1rem; text-decoration:none; padding:0.7rem 1rem; border-radius:0.8rem; transition:all 0.2s;">
      <span style="display:inline-flex; align-items:center;">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="4" y="4" width="16" height="16" rx="4" stroke="{% if active_page == 'attendance' %}#e63038{% else %}#666{% endif %}" stroke-width="2"/>
          <path d="M8 10h8M8 14h5" stroke="{% if active_page == 'attendance' %}#e63038{% else %}#666{% endif %}" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </span>
      <span class="sidebar-link-text">Attendance</span>
    </a>
  </nav>
</aside>
<!-- Profile Sidebar -->
<div id="profile-sidebar" style="position:fixed; top:0; right:-350px; width:350px; max-width:95vw; height:100vh; background:rgba(255,255,255,0.95); box-shadow:-8px 0 40px #e6303820; z-index:2100; transition:right 0.35s cubic-bezier(.77,0,.18,1); overflow-y:auto; display:flex; flex-direction:column; border-top-left-radius:2.2rem; border-bottom-left-radius:2.2rem; backdrop-filter:blur(8px);">
  <!-- Logout Button Box -->
  <div style="width:100%; display:flex; justify-content:flex-end; padding:1.1rem 1.1rem 0 1.1rem;">
    <button id="logout-btn" style="background:#f3f3f3; border:none; border-radius:1.2rem; color:#888; font-weight:600; font-size:0.98rem; display:flex; align-items:center; gap:0.5rem; box-shadow:0 2px 8px #0001; padding:0.5rem 1.1rem; transition:background 0.2s, color 0.2s;">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16 17L21 12L16 7" stroke="#888" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 12H9" stroke="#888" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 19C7.58 19 4 15.42 4 11C4 6.58 7.58 3 12 3C13.85 3 15.55 3.63 16.88 4.69" stroke="#888" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Logout
    </button>
  </div>
  <!-- Profile Info -->
  <div style="display:flex; align-items:center; gap:1.1rem; padding:0.7rem 1.1rem 0.5rem 1.1rem; margin-top:0.2rem;">
    <span id="profile-photo-container" style="display:block; width:4.1rem; height:4.1rem; border-radius:50%; background:linear-gradient(135deg,#e63038,#ff7e5f); overflow:hidden; box-shadow:0 2px 8px #e6303820; border:2px solid #e63038;">
      {% if user.teacheraccount.profile_photo %}
        <img id="profile-photo-img" src="{{ user.teacheraccount.profile_photo.url }}" alt="Profile Photo" style="width:100%; height:100%; object-fit:cover; border-radius:50%; border:none;"/>
      {% else %}
        <svg id="profile-photo-img" width="60" height="60" viewBox="0 0 24 24" fill="none" style="display:block; border-radius:50%; background:linear-gradient(135deg,#e63038,#ff7e5f);" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="8" r="4" stroke="#fff" stroke-width="2"/>
          <path d="M4 20c0-2.21 3.58-4 8-4s8 1.79 8 4" stroke="#fff" stroke-width="2"/>
        </svg>
      {% endif %}
    </span>
    <div style="display:flex; flex-direction:column; justify-content:center; align-items:flex-start;">
      <div style="font-weight:700; color:#e63038; font-size:1.08rem; margin-bottom:0.13rem; letter-spacing:0.3px;">{{ user.username }}</div>
      <div style="color:#888; font-size:0.98rem; font-weight:600;">Teacher</div>
    </div>
  </div>
  <!-- Profile Actions -->
  <div style="padding:1.2rem 1.1rem 0 1.1rem; display:flex; flex-direction:column; gap:1.1rem;">
    <input type="file" id="profile-photo-input" accept="image/*" style="display:none;"/>
    <button id="change-photo-btn" class="btn btn-primary" style="width:100%; font-size:1.05rem; font-weight:700; border-radius:1.1rem; box-shadow:0 2px 8px #e6303820;">Change Profile Photo</button>
    <button id="leave-class-btn" class="btn btn-secondary" style="width:100%; border-radius:1.1rem;">Leave Class</button>
    <a href="/teacher/profile/" id="view-profile-btn" class="btn btn-primary" style="width:100%; font-size:1.05rem; font-weight:700; background:#fff0f0; color:#e63038; border:1.5px solid #e63038; border-radius:1.1rem; box-shadow:0 2px 8px #e6303820;">View Profile</a>
  </div>
</div>
<!-- Profile Sidebar Overlay -->
<div id="profile-sidebar-overlay" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.25); z-index:2000;"></div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
// Logout button logic
const logoutBtn = document.getElementById('logout-btn');
if (logoutBtn) {
  logoutBtn.onclick = async function() {
    const result = await Swal.fire({
      title: 'Logout?',
      text: 'Are you sure you want to logout?',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#e63038',
      cancelButtonColor: '#888',
      confirmButtonText: 'Logout',
      reverseButtons: true
    });
    if (result.isConfirmed) {
      fetch('/logout/', {method: 'POST', headers: {'X-CSRFToken': getCookie('csrftoken')}})
        .then(() => { window.location.href = '/'; })
        .catch(() => { Swal.fire('Error', 'Logout failed.', 'error'); });
    }
  };
}
// Change profile photo logic
const changePhotoBtn = document.getElementById('change-photo-btn');
const profilePhotoInput = document.getElementById('profile-photo-input');
if (changePhotoBtn && profilePhotoInput) {
  changePhotoBtn.onclick = function() { profilePhotoInput.click(); };
  profilePhotoInput.onchange = function(e) {
    const file = e.target.files[0];
    if (!file) return;
    const formData = new FormData();
    formData.append('profile_photo', file);
    fetch('/teacher/upload_profile_photo/', {
      method: 'POST',
      body: formData,
      headers: {'X-CSRFToken': getCookie('csrftoken')}
    })
    .then(r => r.json())
    .then(data => {
      if (data.status === 'success') {
        document.getElementById('profile-photo-img').src = data.photo_url;
        Swal.fire('Success', 'Profile photo updated!', 'success');
      } else {
        Swal.fire('Error', data.message || 'Failed to update photo.', 'error');
      }
    })
    .catch(() => Swal.fire('Error', 'Failed to update photo.', 'error'));
  };
}
// Leave class logic
const leaveClassBtn = document.getElementById('leave-class-btn');
if (leaveClassBtn) {
  leaveClassBtn.onclick = async function() {
    const result = await Swal.fire({
      title: 'Leave Class?',
      text: 'Are you sure you want to leave this class? You will lose access to its notes and attendance.',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#e63038',
      cancelButtonColor: '#888',
      confirmButtonText: 'Leave',
      reverseButtons: true
    });
    if (result.isConfirmed) {
      fetch('/teacher/leave_class/', {method: 'POST', headers: {'X-CSRFToken': getCookie('csrftoken')}})
        .then(r => r.json())
        .then(data => {
          if (data.status === 'success') {
            Swal.fire('Left Class', 'You have left the class.', 'success').then(() => window.location.reload());
          } else {
            Swal.fire('Error', data.message || 'Failed to leave class.', 'error');
          }
        })
        .catch(() => Swal.fire('Error', 'Failed to leave class.', 'error'));
    }
  };
}
// Helper to get CSRF token
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}
  // Header tabs animation and delayed navigation (teacher)
  (function initHeaderTabsTeacher() {
    const tabs = document.getElementById('header-tabs-teacher');
    if (!tabs) return;
    const links = Array.from(tabs.querySelectorAll('.tab-link'));
    const indicator = tabs.querySelector('.active-indicator');
    function positionIndicator(target) {
      const tabsRect = tabs.getBoundingClientRect();
      const rect = target.getBoundingClientRect();
      const left = rect.left - tabsRect.left + 4;
      const width = rect.width - 8;
      indicator.style.transform = `translateX(${left}px)`;
      indicator.style.width = `${width}px`;
    }
    const active = tabs.querySelector('.tab-link.active') || links[0];
    positionIndicator(active);
    window.addEventListener('resize', () => positionIndicator(tabs.querySelector('.tab-link.active') || links[0]));
    links.forEach(link => {
      link.addEventListener('click', (e) => {
        if (link.classList.contains('active')) return;
        e.preventDefault();
        links.forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        positionIndicator(link);
        setTimeout(() => { window.location.href = link.href; }, 240);
      });
    });
  })();
</script> 